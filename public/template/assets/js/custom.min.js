//CONTROLADOR DE FUNCTIONS DE INTERFASE
var controllerGeralFunction;
var controllerGeralModal;
$(function () {
    "use strict";
    var e = function () {
        (0 < window.innerWidth ? window.innerWidth : this.screen.width) < 1170 ? $("#main-wrapper").attr("data-sidebartype", "mini-sidebar") : configSidebar === 'full' ? $("#main-wrapper").attr("data-sidebartype", "full") : $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
        //(0 < window.innerWidth ? window.innerWidth : this.screen.width) < 1170 ? $("#main-wrapper").attr("data-sidebartype", "mini-sidebar") : $("#main-wrapper").attr("data-sidebartype", "full")
    };
    $(window).ready(e), $(window).on("resize", e), $(".left-sidebar").hover(function () {
        $(".navbar-header").addClass("expand-logo");
    }, function () {
        $(".navbar-header").removeClass("expand-logo");
    }), $(".nav-toggler").on("click", function () {
        $("#main-wrapper").toggleClass("show-sidebar"), $(".nav-toggler i").toggleClass("ti-menu");
    }), $(".search-box a, .search-box .app-search .srh-btn").on("click", function () {
        $(".app-search").toggle(200), $(".app-search input").focus();
    }), $(function () {
        $(".service-panel-toggle").on("click", function () {
            $(".customizer").toggleClass("show-service-panel");
        }), $(".page-wrapper").on("click", function () {
            $(".customizer").removeClass("show-service-panel");
        });
    }), $(".floating-labels .form-control").on("focus blur", function (e) {
        $(this).parents(".form-group").toggleClass("focused", "focus" === e.type || 0 < this.value.length);
    }).trigger("blur"), $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    }), $(function () {
        $('[data-toggle="popover"]').popover();
    }), $("body, .page-wrapper").trigger("resize"), $(".page-wrapper").delay(20).show(), $('a[data-action="collapse"]').on("click", function (e) {
        e.preventDefault(), $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"), $(this).closest(".card").children(".card-body").collapse("toggle");
    }), $('a[data-action="expand"]').on("click", function (e) {
        e.preventDefault(), $(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"), $(this).closest(".card").toggleClass("card-fullscreen");
    }), $('a[data-action="close"]').on("click", function () {
        $(this).closest(".card").removeClass().slideUp("fast");
    }), $(document).on("click", ".mega-dropdown", function (e) {
        e.stopPropagation();
    });
    var a, o = function () {
        $(".lastmonth").sparkline([6, 10, 9, 11, 9, 10, 12], {type: "bar", height: "35", barWidth: "4", width: "100%", resize: !0, barSpacing: "8", barColor: "#2961ff"});
    };
    $(window).resize(function (e) {
        clearTimeout(a), a = setTimeout(o, 500);
    }), o(), $(".show-left-part").on("click", function () {
        $(".left-part").toggleClass("show-panel"), $(".show-left-part").toggleClass("ti-menu");
    });
    //FUNCTION SIDE BAR
    $('#toggleSideBar').unbind("click").click(function () {
        $(this);
        if ($('#main-wrapper').attr('data-sidebartype') === 'full') {
            setConfig(2, 2);
            $('#main-wrapper').addClass("mini-sidebar");
            $('#main-wrapper').attr('data-sidebartype', 'mini-sidebar');
        } else if ($('#main-wrapper').attr('data-sidebartype') === 'mini-sidebar') {
            setConfig(2, 1);
            $('#main-wrapper').removeClass("mini-sidebar");
            $('#main-wrapper').attr('data-sidebartype', 'full');
        }
    });
    
    $(".message-center, .customizer-body, .scrollable").perfectScrollbar({wheelPropagation: !0});
    $('.scroll').perfectScrollbar();
    ////////////////////////////////////////////////////////////////////////////
    //                             - MANOEL LOURO -                           //
    ////////////////////////////////////////////////////////////////////////////
    /**
     * Controlador CUSTOM de funções globais da interfase
     * @type array
     */
    controllerGeralFunction = {
        tempo: 60000,
        tempoLog: 100000,
        notificacao: async function () {
            $.ajax({
                url: APP_HOST + '/usuario/getRegistroAJAX',
                data:{
                    operacao: 'getNotificacaoPendenteUsuario'
                },
                type: 'POST',
                dataType: 'json'
            }).done(function (lista) {
                if (lista.length) {
                    $('.noti').html(lista.length);
                    $('#interfaseNotificationImg').css('animation', 'ring 1s infinite');
                } 
            });
        },
        configInterfase: async function (element) {
            /**
             * Verifica qual element foi enviado
             */
            switch (element) {
                case 'templateMenu':
                    if ($('#main-wrapper')) {
                        setConfig(2, 1);
                        if ($(window).width() > 800) {
                            $('#main-wrapper').attr('data-sidebartype', 'full');
                            $('#main-wrapper').attr('class', '');
                        }
                    } else if (parseInt($('#templateMenu').val()) === 2) {
                        setConfig(2, 2);
                        if ($(window).width() > 800) {
                            $('#main-wrapper').attr('data-sidebartype', 'mini-sidebar');
                            $('#main-wrapper').attr('class', 'mini-sidebar');
                        }
                    }
                    break;
                case 'templateTema':
                    if (document.getElementById('customRadio1').checked) {
                        setConfig(1, 1);
                        $('body').attr('data-theme', '');
                    } else if (document.getElementById('customRadio2').checked) {
                        setConfig(1, 2);
                        $('body').attr('data-theme', 'dark');
                    }
                    
                    break;
            }
        },
        getTemplateFerramenta: function () {
            Swal.fire({
                title: 'Em Construção',
                text: "A função de ferramenta ainda não está disponível nesta versão",
                showCancelButton: false,
                confirmButtonText: 'Confirmar'
            });
        }
    };
    //INICIALIZA FUNÇAO PERIODICA
    setInterval(async function () {
        await controllerGeralFunction.notificacao();
    }, controllerGeralFunction.tempo);
    controllerGeralFunction.notificacao();
    $('#interfaseNotificationImg').on('click', function(){
        window.location=APP_HOST + '/notificacao';
    });
    ////////////////////////////////////////////////////////////////////////////
    //                              - REQUEST -                               //
    //                                                                        //
    ////////////////////////////////////////////////////////////////////////////
    
    /**
     * REQUEST
     * Atualiza configuração do usuario.
     * 
     * @author    Manoel Louro
     * @date      08/05/2019
     */
    function setConfig(config, valor) {
        //AJAX
        $.ajax({
            url: APP_HOST + '/usuarioConfiguracao/setRegistroAJAX',
            data: {
                operacao: 'setConfiguracaoUsuario',
                config: config,
                valor: valor
            },
            type: 'post',
            dataType: 'json'
        });
    }
});